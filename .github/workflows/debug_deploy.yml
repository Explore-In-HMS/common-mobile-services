## 1
name: Build Debug Apk and Deploy

## Actions that will be executed when pull request is created
on:
  pull_request:
    branches:
      - master

jobs:
  ## Debug
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: 11
          distribution: 'adopt'
      # 3.1
      - name: Clean Project
        run: ./gradlew clean
      # 3.2
      - name: Generate Debug APK
        run: ./gradlew assembleDebug --stacktrace

      # 4
      - name: Upload APK to artifacts
        uses: actions/upload-artifact@v3
        with:
          name: app-debug.apk
          path: app/build/outputs/apk/debug/app-debug.apk

  # deploy_To_Firebase
  deploy-firebase:
    # 1
    needs: [ build ]
    runs-on: ubuntu-latest
    steps:
      # 2
      - uses: actions/download-artifact@v3
        with:
          name: app-debug.apk
      # Setup Google Cloud
      - name: Setup Google Cloud
        uses: google-github-actions/setup-gcloud@master
        with:
          service_account_key: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_JSON }}
          project_id: <your_project_id_here>
      # Deploy to Firebase
      - name: Deploy to Firebase
        run: firebase deploy --only hosting
        env:
          GOOGLE_APPLICATION_CREDENTIALS: /tmp/google-application-credentials.json
        # Ensure GOOGLE_APPLICATION_CREDENTIALS environment variable is set
        before_deploy:
          - run: echo "${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_JSON }}" > /tmp/google-application-credentials.json
          - run: firebase appdistribution:distribute app-debug.apk --app ${{secrets.FIREBASE_APP_ID}} --groups debug-test
